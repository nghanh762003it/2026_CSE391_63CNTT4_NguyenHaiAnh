<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Exercise 06</title>
</head>

<body>
  <form onsubmit="handleSubmit(); return false;">
    <label>
      Name:
      <input type="text" id="studentName" />
    </label>

    <label>
      Age:
      <input type="number" id="studentAge" />
    </label>

    <button type="submit" id="submitBtn">Add</button>
  </form>

  <br>

  <table border="1">
    <thead>
      <tr>
        <th>ID</th>
        <th>Name</th>
        <th>Age</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody id="tableBody"></tbody>
  </table>

  <script>
    // ===== APPLICATION STATE =====
    // Mảng lưu toàn bộ dữ liệu student
    let students = [];

    // ID tự tăng
    let counter = 1;

    // Nếu null => đang ở chế độ Add
    // Nếu có giá trị => đang chỉnh sửa student có id đó
    let editingId = null;

    const nameInput = document.getElementById("studentName");
    const ageInput = document.getElementById("studentAge");
    const tableBody = document.getElementById("tableBody");
    const submitBtn = document.getElementById("submitBtn");


    // ===== HANDLE FORM SUBMIT =====
    function handleSubmit() {
      const name = nameInput.value.trim();
      const age = Number(ageInput.value);

      // Validate dữ liệu đầu vào
      if (!name) {
        alert("Please enter a name.");
        return;
      }

      if (!age || age <= 0) {
        alert("Please enter a valid age.");
        return;
      }

      // Nếu chưa có editingId => đang ở Add mode
      if (editingId === null) {

        const student = {
          id: counter++,
          name: name,
          age: age
        };

        students.push(student);

      } else {
        // Nếu có editingId => đang Update
        const student = students.find(s => s.id === editingId);

        // Cập nhật trực tiếp object trong mảng
        student.name = name;
        student.age = age;

        // Reset về Add mode sau khi update xong
        editingId = null;
        submitBtn.textContent = "Add";
      }

      
      renderTable();

      // Reset form
      nameInput.value = "";
      ageInput.value = "";
      nameInput.focus();
    }


    // ===== RENDER TABLE FROM STATE =====
    function renderTable() {

      // Xóa toàn bộ nội dung cũ trước khi render lại
      tableBody.innerHTML = "";

      // Nếu không có dữ liệu
      if (students.length === 0) {
        const row = document.createElement("tr");
        const cell = document.createElement("td");
        cell.colSpan = 4;
        cell.textContent = "No students available.";
        row.appendChild(cell);
        tableBody.appendChild(row);
        return;
      }

      // Render mỗi student trong mảng
      students.forEach(student => {

        const row = document.createElement("tr");

        const idCell = document.createElement("td");
        const nameCell = document.createElement("td");
        const ageCell = document.createElement("td");
        const actionCell = document.createElement("td");

        idCell.textContent = student.id;
        nameCell.textContent = student.name;
        ageCell.textContent = student.age;

        // ===== EDIT BUTTON =====
        const editBtn = document.createElement("button");
        editBtn.textContent = "Edit";
        editBtn.addEventListener("click", function() {
          editStudent(student.id);
        });

        // ===== DELETE BUTTON =====
        const deleteBtn = document.createElement("button");
        deleteBtn.textContent = "Delete";
        deleteBtn.addEventListener("click", function() {
          deleteStudent(student.id);
        });

        actionCell.appendChild(editBtn);
        actionCell.appendChild(deleteBtn);

        row.appendChild(idCell);
        row.appendChild(nameCell);
        row.appendChild(ageCell);
        row.appendChild(actionCell);

        tableBody.appendChild(row);
      });
    }


    // ===== EDIT LOGIC =====
    function editStudent(id) {

      const student = students.find(s => s.id === id);

      // Đổ dữ liệu lên form
      nameInput.value = student.name;
      ageInput.value = student.age;

      // Chuyển sang Edit mode
      editingId = id;

      // Đổi nút thành Update để UX rõ ràng
      submitBtn.textContent = "Update";

      nameInput.focus();
    }


    // ===== DELETE LOGIC =====
    function deleteStudent(id) {

      if (!confirm("Are you sure you want to delete this student?")) return;

      // Tạo mảng mới loại bỏ student có id cần xóa
      students = students.filter(student => student.id !== id);

      // Nếu đang edit đúng student bị xóa => reset về Add mode
      if (editingId === id) {
        editingId = null;
        submitBtn.textContent = "Add";
        nameInput.value = "";
        ageInput.value = "";
      }

      // Render lại sau khi xóa
      renderTable();
    }


    // Render lần đầu khi trang load
    renderTable();

  </script>
</body>
</html>